var MAX_INPUT_SIZE=50;var CONTENT_MAX_LEN=500;var NOCACHE=0;var VIEW_LIST=1;var VIEW_MAGAZINE=2;var VIEW_STREAM=3;var TEMPLATE_ID_STREAM="stream";var TEMPLATE_ID_ALL="all";var TEMPLATE_ID_RECENTLY_READ="rr";var TEMPLATE_ID_SAVED="saved";var TEMPLATE_ID_SOURCE="source";var FILTER_SHOW_ALL=0;var FILTER_BY_UNREAD=1;var SORT_NEW_FIRST=0;var SORT_OLD_FIRST=1;var ROUTE_FEED="f";var ROUTE_FEED_SOURCE="s";var ROUTE_VIEW="v";var ROUTE_ALL="a";var ROUTE_SAVED="s";var ROUTE_RECENTLY_READ="r";var apiCurrentStreamsFeed=";";var apiUrlStreamsFeedAll="/api/v1/user/feeds/all";var apiUrlStreamsFeedRecent="/api/v1/entries/recently_read";var apiUrlStreamsFeedSaved="/api/v1/entries/saved";var apiUrlStreamsFeed="/api/v1/user/streams/feed";var apiUrlMarkRead="/api/v1/entries/read";var apiUrlStreamUpdate="/api/v1/user/streams/update";var apiUrlStreamDelete="/api/v1/user/streams/delete";var apiUrlStreamsList="/api/v1/user/streams/list";var apiUrlStreamsMarkAllRead="/api/v1/user/streams/allread";var apuUrlStreamsUnreadCount="/api/v1/user/streams/unreadcount";var apiUrlSaveReaderSettings="/api/v1/user/settings/reader";var apiUrlSaveModulesSettings="/api/v1/user/settings/modules";var apiUrlEntriesData="/api/v1/user/feeds/data";var apiUrlSourcesGet="/api/v1/sources/get";var apiUrlSubscriptionsAdd="/api/v1/user/subscriptions/add";var apiUrlRecentlyReadClear="/api/v1/entries/clear_recently_read";var apiUrlEntriesEntry="/api/v1/entries/entry";var apiUrlStreamsRename="/api/v1/user/streams/rename";var apiUrlEntriesUpdate="/api/v1/entries/update";var apiUrlSubscriptionsGet="/api/v1/user/subscriptions/get";var apiUrlSourceId="/api/v1/user/feeds/sourceid";var apiUrlStreamsAdd="/api/v1/user/streams/add";var baseFavicoDomain="http://www.google.com/s2/favicons?domain=";var streamId=0;var streamDir=0;var entriesApi="";var readerHome="";var profileId=0;var tmplOptions={id:"",showIco:true,showSource:true,sourceLen:12};var streamGroups={};var filteredStreamGroups=streamGroups;var selectedStream={};var streamEntries={};var moreAvailable=true;var currentView=1;var streamGroupsTmpl;var streamGroupsSmallTmpl;var streamGroupHeaderTmpl;var sourceHeaderTmpl;var recentlyReadHeaderTmpl;var simpleViewHeaderTmpl;var contentAllRead={};var entriesTmpl;var viewLineTmpl;var viewMagTmpl;var viewNewsTmpl;var pageUnknownTmpl;var streamPage=0;var entriesPerPage=0;var pendingRequest=false;var topUnread=undefined;var lastRead=undefined;var queryGroups={showUnreadOnly:false,sortByAlphabet:0,sortByUnread:0};var renderTime=new Date().getTime();var onEntriesLoadedListeners=[];var onViewChangedListeners=[];var router={};function initReader(){readerHome=baseUrl+"/pages/reader.jsp";setupTemplates();setupRoutes();tmplOptions.id=TEMPLATE_ID_STREAM;initReaderSubscriptions();setupEvents()}function setupEvents(){window.onscroll=function(c){if($("#stream_more").visible()){loadMore()}if(selectedStream.h_filter_by!=FILTER_BY_UNREAD){return}if(!topUnread){return}var d=topUnread.get(0);if(typeof d.getBoundingClientRect==="function"){var b=d.getBoundingClientRect();if(b.top<70){if(lastRead!=topUnread){markRead(topUnread.get(0));lastRead=topUnread}var a=topUnread.next(".news");if(a.length==1){lastTopY=b.top;topUnread=a}}}};registerOnEntriesLoadedListeners(function(a){if(!a||!a.entries){return}updateNewsListView()})}function setupTemplates(){Handlebars.registerPartial("header_right_tools",$("#header_right_tools").html());streamGroupsTmpl=Handlebars.compile($("#stream_groups_tmpl").html());streamGroupsSmallTmpl=Handlebars.compile($("#stream_groups_small_tmpl").html());viewLineTmpl=Handlebars.compile($("#news_line_tmpl").html());viewMagTmpl=Handlebars.compile($("#news_mag_tmpl").html());viewNewsTmpl=Handlebars.compile($("#news_stream_tmpl").html());entriesTmpl=viewLineTmpl;sourceHeaderTmpl=Handlebars.compile($("#source_header_tmpl").html());recentlyReadHeaderTmpl=Handlebars.compile($("#recently_read_header_tmpl").html());simpleViewHeaderTmpl=Handlebars.compile($("#simple_view_header_tmpl").html());contentAllRead=Handlebars.compile($("#content_all_read").html());contentEmptySource=Handlebars.compile($("#content_empty_source").html());pageUnknownTmpl=Handlebars.compile($("#content_unknown").html())}function setupRoutes(){router=new Router().init();router.on("/f/:feedid",loadStream);router.on("/r/:feedid",reloadStream);router.on("/v/a",loadAll);router.on("/v/r",loadRecentlyRead);router.on("/v/s",loadSaved);router.on("/s/:sourceid",loadSource)}function apiMarkRead(a,c){var b={};b.e=a;b.sid=selectedStream.l_stream_id;b.c=selectedStream.l_gr_unread;$.get(baseUrl+apiUrlMarkRead,b,function(e,d){if(c){c(e,d)}})}function setProfile(a){this.profileId=a.profileId;queryGroups.showUnreadOnly=a.settings.showUnreadOnly;if(a.settings.sortAz==1||a.settings.sortAz==2){queryGroups.sortByAlphabet=a.settings.sortAz}if(a.settings.sortUnread==1||a.settings.sortUnread==2){queryGroups.sortByUnread=a.settings.sortUnread}}function setEntriesPerPage(a){entriesPerPage=a}function registerOnEntriesLoadedListeners(a){onEntriesLoadedListeners.push(a)}function triggerOnEntriesLoadedListeners(b){for(var a=0;a<onEntriesLoadedListeners.length;a++){onEntriesLoadedListeners[a](b)}}function registerChangeViewListener(a){onViewChangedListeners.push(a)}function triggerChangeViewListeners(a){for(var b=0;b<onViewChangedListeners.length;b++){onViewChangedListeners[b](a)}}function displayStreamHeader(){if(!streamGroupHeaderTmpl){streamGroupHeaderTmpl=Handlebars.compile($("#stream_group_header_tmpl").html())}$("#stream_group_header").html(streamGroupHeaderTmpl(selectedStream));$("#txt_stream_rename").keyup(function(a){if((a.keyCode||a.which)==13){renameStreamGroup()}if((a.keyCode||a.which)==27){$("#div_stream_rename").hide();$("#span_stream_rename").show()}})}function showOnlyWithUnread(a){queryGroups.showUnreadOnly=a;runQuery();saveReaderSettings()}function sortByAlphabet(a){queryGroups.sortByAlphabet=a;queryGroups.sortByUnread=0;runQuery();saveReaderSettings()}function sortByUnread(a){queryGroups.sortByUnread=a;queryGroups.sortByAlphabet=0;runQuery();saveReaderSettings()}function runQuery(){var a=jlinq.from(streamGroups);if(queryGroups.showUnreadOnly){a.greater("l_gr_unread",0)}if(queryGroups.sortByAlphabet!=0){a.sort(((queryGroups.sortByAlphabet==1)?"-":"")+"s_stream_name")}if(queryGroups.sortByUnread!=0){a.sort(((queryGroups.sortByUnread==1)?"-":"")+"l_gr_unread")}filteredStreamGroups=a.select();renderStreamGroups(filteredStreamGroups)}function renderStreamGroups(a){if($("#menusubs").is(":hidden")){$("#small_menusubs").html(streamGroupsSmallTmpl({groups:a}))}else{$("#menusubs").html(streamGroupsTmpl({groups:a}))}selectDom("e_"+selectedStream.l_stream_id)}function getUnreadCount(e,d,f){var c="";for(var b=0;b<e.length;b++){c+=e[b].l_stream_id+","}if(c.length==0){if(f){f()}else{return}}if(d==undefined){d=0}var a={};a.sid=c.slice(0,-1);a.nc=d;$.getJSON(baseUrl+apuUrlStreamsUnreadCount,a,function(k,h){for(var g=0;g<streamGroups.length;g++){for(var j=0;j<k.entries.length;j++){if(streamGroups[g].l_stream_id==k.entries[j].id){streamGroups[g].l_gr_unread=k.entries[j].count;break}}}runQuery();if(f!=undefined){f()}})}function refreshUnread(){getUnreadCount(streamGroups,1)}function getStreamGroups(b){var a={};a.views=true;$.getJSON(baseUrl+apiUrlStreamsList,a,function(c){streamGroups=c;getUnreadCount(streamGroups,0,function(){if(b){b(streamGroups,filteredStreamGroups)}})})}function closeAllHeaderTools(){$("#header_subscriptions").css("display","none");return false}function showRename(a){$("#span_"+a).hide();$("#div_"+a).show();input=$("#txt_"+a);txt=input.val();input.val("");input.focus();input.val(txt)}function toggleHeaderTool(a){switch(a){case"subscriptions":$("#header_subscriptions").toggle();renderSubscriptions();break}}function showImport(){showModal("Add new feed to '"+selectedStream.s_stream_name+"'","#div_add_subscription",function a(){})}function importSingleFeed(){var a={};a.n=$("input[name=sName]:visible").val();a.u=$("input[name=sUrl]:visible").val();$.getJSON(baseUrl+apiUrlSubscriptionsAdd,a,function(b){if(b.success){hideModal();loadStream(selectedStream.l_stream_id)}else{if(b.error){modalError(b.error)}else{console.error("error importing single feed, data: ");console.error(b)}}})}function showDeleteStream(){$("#modalBox").attr("data-stream_id",selectedStream.l_stream_id);showModal("Delete Stream","#div_delete_stream")}function confirmClearRecentlyRead(){if(confirm("This will clear all recently read articles for this profile. Are you sure?")){$.getJSON(baseUrl+apiUrlRecentlyReadClear,{},function(a){if(a.count>=0){loadRecentlyRead()}else{console.error("error deleting entreis");console.error(a)}})}}function deleteStream(){var a={};a.sid=$("#modalBox").attr("data-stream_id");a.dp=$("input[name=delete_profiles]:visible").is(":checked");$.getJSON(baseUrl+apiUrlStreamDelete,a,function(b){if(b.count>0){location.assign(readerHome)}});return false}function updateStreamGroupsList(a,b){for(var c=0;c<streamGroups.length;c++){if(streamGroups[c].i==a){streamGroups[c].n=b;break}}$("#menusubs").html(streamGroupsTmpl({groups:streamGroups}))}function sendActionEntry(b,c,d){var a={};a.id=b;a.act=c;$.getJSON(baseUrl+apiUrlEntriesEntry,a,function(e){d(e)})}function removeEntry(a){sendActionEntry(a,"r",function(b){if(b.count==1){$("#news_"+a).remove()}else{if(b.count==0){console.error("wasnt not saved.")}else{console.error("save error")}}})}function saveEntry(a){sendActionEntry(a,"s",function(b){if(b.count>=0){$("#news_"+a).addClass("saved");setTimeout(function(){$("#news_"+a).removeClass("saved")},1500)}else{console.error("save error")}})}function renameSubscription(){var b=$("#txt_subscription_rename").val();var a=$("#txt_subscription_rename").attr("data-value");saveSubscription(a,b,function(c){if(c.count>0){$("#div_subscription_rename").hide();$("#span_subscription_rename").text(b);$("#span_subscription_rename").show()}else{console.error("error renaming subscription, data ");console.error(c)}})}function renameStreamGroup(){var a={};a.sid=selectedStream.l_stream_id;a.sn=$("#txt_stream_rename").val();$.getJSON(baseUrl+apiUrlStreamsRename,a,function(b){if(b.count>0){selectedStream.s_stream_name=a.sn;displayStreamHeader();updateStreamGroupsList(a.sid,a.sn)}})}function fetchFavIcos(){uniqueSources=[];for(var b=0;b<streamEntries.length;b++){var c=streamEntries[b].l_xml_id;if(uniqueSources.indexOf(c)>=0){continue}uniqueSources.push(c)}var a={};a.ids=uniqueSources.toString();a.qtype=1;$.getJSON(baseUrl+apiUrlSourcesGet,a,function(d){if(d&&d.entries){d.entries.forEach(function(h,g,f){if(h.s_link!=""){$("img[name=favico_"+h.l_xml_id+"]").attr("src",baseFavicoDomain+h.s_link)}else{if(h.s_xml_url){$("img[name=favico_"+h.l_xml_id+"]").attr("src",baseFavicoDomain+h.s_xml_url)}}})}})}function fetchNewsData(a,d){var b={};b.entries="";b.img=a;b.cnt=d;b.ml=CONTENT_MAX_LEN;for(var c=0;c<streamEntries.length;c++){b.entries+=streamEntries[c].l_entry_id;if(c+1!=streamEntries.length){b.entries+=","}}$.getJSON(baseUrl+apiUrlEntriesData,b,function(g){if(g.entries){for(var f=0;f<g.entries.length;f++){if(a&&g.entries[f]){if(g.entries[f].s_thumb_url==""){$("#img_"+g.entries[f].l_entry_id).remove()}else{if(currentView==VIEW_STREAM){var e=document.createElement("img");e.src=g.entries[f].s_thumb_url;$("#img_"+g.entries[f].l_entry_id).html(e)}else{if(currentView==VIEW_MAGAZINE){$("#img_"+g.entries[f].l_entry_id).css("background","url("+g.entries[f].s_thumb_url+") no-repeat center").css("background-size","220px")}}}}if(d&&g.entries[f].content){$("#cnt_"+g.entries[f].l_entry_id).html(g.entries[f].content)}}}})}function markRead(a){a.className=a.className+" read";apiMarkRead($(a).attr("data-id"),function(c,b){if(c.count){selectedStream.l_gr_unread--;updateUnread();runQuery()}})}function apiStreamRead(c,d){var b={};b.sid=c;b.t=renderTime;$.getJSON(baseUrl+apiUrlStreamsMarkAllRead,b,function a(f,e){if(d){d(f)}},"json")}function markAllRead(){$(".news").not(".read").each(function(a,b){$(b).addClass("read")});apiStreamRead(selectedStream.l_stream_id,function(a){selectedStream.l_gr_unread=0;clearViewAndData();updateUnread();updateNewsListView();runQuery()});$(".mark_all_read").hide();moveTop()}function moveTop(){$(window).scrollTop(0)}function setLineView(){currentView=VIEW_LIST;clearView();loadEntries(0)}function setMagazineView(){currentView=VIEW_MAGAZINE;clearView();loadEntries(0)}function setStreamView(){currentView=VIEW_STREAM;clearView();loadEntries(0)}function updateNewsListView(){setViewOptions();updateNewsContentPane(streamEntries.length);updateHeaderRightTools();if(tmplOptions.id==TEMPLATE_ID_STREAM){var a={};a.sid=selectedStream.l_stream_id;a.filter=selectedStream.h_filter_by;a.sort=selectedStream.h_sort_by;a.v=currentView;a.c=selectedStream.l_gr_unread;$.getJSON(baseUrl+apiUrlStreamUpdate,a,function(b,c){},"json")}else{var a={};a.tmpl=tmplOptions.id;a.v=currentView;switch(tmplOptions.id){case TEMPLATE_ID_SAVED:selectedProfile.saved_settings.view=currentView;break;case TEMPLATE_ID_ALL:selectedProfile.all_settings.view=currentView;break;case TEMPLATE_ID_RECENTLY_READ:selectedProfile.rr_settings.view=currentView;break}$.getJSON(baseUrl+apiUrlSaveModulesSettings,a,function(b,c){},"json")}if(topUnread==undefined){topUnread=$(".news").first()}fetchFavIcos();if(currentView==VIEW_MAGAZINE||currentView==VIEW_STREAM){fetchNewsData(true,true)}triggerChangeViewListeners(currentView)}function updateHeaderRightTools(){$(".mark_all_read").hide();if(tmplOptions.id==TEMPLATE_ID_SOURCE){$("#right_tools").remove()}if(selectedStream.h_filter_by==FILTER_SHOW_ALL){$("#show_unread").css("text-decoration","none");$("#show_all").css("text-decoration","underline")}else{if(selectedStream.h_filter_by==FILTER_BY_UNREAD){$("#show_unread").css("text-decoration","underline");$("#show_all").css("text-decoration","none");if(streamEntries.length>0){$(".mark_all_read").show()}}}if(selectedStream.h_sort_by==SORT_NEW_FIRST){$("#oldest_first").css("text-decoration","none");$("#newset_first").css("text-decoration","underline")}else{if(selectedStream.h_filter_by==SORT_OLD_FIRST){$("#oldest_first").css("text-decoration","underline");$("#newset_first").css("text-decoration","none")}}}function setViewOptions(){$("#icon_view_line").removeClass("icon-view-bgcolor");$("#icon_view_mag").removeClass("icon-view-bgcolor");$("#icon_view_stream").removeClass("icon-view-bgcolor");switch(currentView){case VIEW_LIST:tmplOptions.sourceLen=11;$("#icon_view_line").addClass("icon-view-bgcolor");entriesTmpl=viewLineTmpl;break;case VIEW_MAGAZINE:$("#icon_view_mag").addClass("icon-view-bgcolor");tmplOptions.sourceLen=50;entriesTmpl=viewMagTmpl;break;default:case VIEW_STREAM:$("#icon_view_stream").addClass("icon-view-bgcolor");tmplOptions.sourceLen=50;entriesTmpl=viewNewsTmpl;currentView=VIEW_STREAM;break}if(screen.width<1200){tmplOptions.sourceLen=10}if(screen.width<1000){tmplOptions.sourceLen=8;tmplOptions.showSource=false}if(currentView==VIEW_LIST&&screen.width<450){tmplOptions.showIco=false;tmplOptions.titleLen=35}tmplOptions.leftSize=2;tmplOptions.midSize=9;if(!tmplOptions.showSource){tmplOptions.leftSize--;tmplOptions.midSize++}if(!tmplOptions.showIco){tmplOptions.leftSize--;tmplOptions.midSize++}selectedStream.h_view_mode=currentView}function updateNewsContentPane(a){if(a==0||a==undefined){if(tmplOptions.id==TEMPLATE_ID_SOURCE){if(streamPage==0){$("#stream_entries").html(contentEmptySource({id:selectedStream.l_stream_id}))}return}if(tmplOptions.id==TEMPLATE_ID_ALL){renderContentStart()}else{if(tmplOptions.id==TEMPLATE_ID_SAVED){$("#stream_entries").html($("#content_start_saved").html())}else{if(tmplOptions.id==TEMPLATE_ID_RECENTLY_READ){$("#stream_entries").html($("#content_start_recently_read").html())}else{if(streamPage==0&&streamSubscriptions.length!=0){$("#stream_entries").html(contentAllRead({name:selectedStream.s_stream_name}))}else{$("#stream_entries").html($("#content_start_source").html())}}}}}else{$("#stream_more").hide();if(streamEntries.length==entriesPerPage){$("#stream_more").show();moreAvailable=true}$("#stream_entries").append(entriesTmpl({tmplOptions:tmplOptions,midSize:tmplOptions.midSize,entries:streamEntries}))}}function resetTemplate(b,c,a,d){renderTime=new Date().getTime();closeAllHeaderTools();tmplOptions.id=b;tmplOptions.showIco=c;tmplOptions.showSource=a;selectedStream={};$("#simple_view_header").hide();$("#stream_group_header").hide();$("#"+d).show();clearView();moveTop()}function clearContent(){selectedStream={};streamGroups={};filteredStreamGroups={};position=0;$("#right_tools").remove();$("#menusubs").html("");$("#stream_header").html("");$("#stream_config").hide();clearViewAndData()}function clearView(){topUnread=null;pendingRequest=false;$("#stream_entries").html("");$("#stream_more").hide();$(".mark_all_read").hide()}function clearViewAndData(){clearView();streamPage=0;streamEntries={};updateNewsListView()}function loadStream(b){this.streamId=b;apiCurrentStreamsFeed=apiUrlStreamsFeed;resetTemplate(TEMPLATE_ID_STREAM,true,true,"stream_group_header");for(var a=0;a<streamGroups.length;a++){if(streamGroups[a].l_stream_id==b){selectedStream=streamGroups[a]}}currentView=selectedStream.h_view_mode;fetchAllStreamSubscriptions(b);displayStreamHeader();loadEntries(0)}function loadAll(){currentView=selectedProfile.all_settings.view;apiCurrentStreamsFeed=apiUrlStreamsFeedAll;resetTemplate(TEMPLATE_ID_ALL,true,true,"simple_view_header");selectDom("mAll");$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries;triggerOnEntriesLoadedListeners(streamEntries)});$("#simple_view_header").html(simpleViewHeaderTmpl({title:"All"}))}function selectDom(a){$(".gselected").removeClass("gselected");$("#"+a).addClass("gselected")}function loadRecentlyRead(){currentView=selectedProfile.rr_settings.view;apiCurrentStreamsFeed=apiUrlStreamsFeedRecent;resetTemplate(TEMPLATE_ID_RECENTLY_READ,true,true,"simple_view_header");selectDom("mRr");$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries;triggerOnEntriesLoadedListeners(streamEntries)});$("#simple_view_header").html(recentlyReadHeaderTmpl({title:"Recently read"}))}function loadSaved(){currentView=selectedProfile.saved_settings.view;apiCurrentStreamsFeed=apiUrlStreamsFeedSaved;resetTemplate(TEMPLATE_ID_SAVED,true,true,"simple_view_header");selectDom("mSaved");$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries;triggerOnEntriesLoadedListeners(streamEntries)});$("#simple_view_header").html(simpleViewHeaderTmpl({title:"Saved"}))}function loadSource(b){resetTemplate(TEMPLATE_ID_SOURCE,false,false,"simple_view_header");apiCurrentStreamsFeed=apiUrlSourceId;var a={};a.id=b;$.getJSON(baseUrl+apiUrlSourcesGet,a,function(c){$("#simple_view_header").html(sourceHeaderTmpl(c))},"json");var a={};a.sid=b;$.getJSON(baseUrl+apiUrlSubscriptionsGet,a,function(d){if(d&&d.l_subs_id){$("#user_subscription").show();var c=(d.s_subs_name.length*2>MAX_INPUT_SIZE)?MAX_INPUT_SIZE:d.s_subs_name.length*2;$("#txt_subscription_rename").attr("size",c);$("#txt_subscription_rename").attr("data-value",d.l_subs_id);$("#txt_subscription_rename").val(d.s_subs_name);$("#span_subscription_rename").html(d.s_subs_name);$("#span_subscription_rename").attr("href",baseUrl+"/pages/subscriptions.jsp#/v/"+d.l_subs_id);$("#txt_subscription_rename").keyup(function(f){if((f.keyCode||f.which)==13){renameSubscription()}if((f.keyCode||f.which)==27){$("#div_subscription_rename").hide();$("#span_subscription_rename").show()}})}});var a={};a.id=b;selectedStream.l_stream_id=b;$.getJSON(baseUrl+apiUrlSourceId,a,function(c){streamEntries=c.entries;updateNewsListView()})}function loadMore(){$("#stream_more").hide();if(!moreAvailable){return}loadEntries(++streamPage)}function updateUnread(){var a=selectedStream.l_gr_unread;if(a<0){selectedStream.l_gr_unread=0}$("#unread").text(a);$("#footer_unread").text(a);if(a==0&&queryGroups.showUnreadOnly){$("#e_"+selectedStream.l_stream_id).hide()}}function loadEntries(c){if(pendingRequest){return}streamPage=c;pendingRequest=true;var b={};b.id=selectedStream.l_stream_id;b.page=c;b.filter=selectedStream.h_filter_by;b.sort=selectedStream.h_sort_by;if(b.filter==FILTER_BY_UNREAD){var a=$(".news").not(".read").length;b.offset=a}$.getJSON(baseUrl+apiCurrentStreamsFeed,b,function(d,e){streamEntries=d.entries;if(d.unread!=undefined){selectedStream.l_gr_unread=d.unread;updateUnread()}else{updateUnread()}runQuery();triggerOnEntriesLoadedListeners(d.entries);pendingRequest=false},"json")}function loadUnknown(){$("#stream_entries").html(pageUnknownTmpl())}function reloadStream(){clearView();loadEntries(0)}function saveStreamGroup(){var b=$("#menusubs input:first-child");if(b.length==0){console.error("error, can't create new stream group.")}var a={};a.sn=b.val();$.getJSON(baseUrl+apiUrlStreamsAdd,a,function(c){if(c.success){getStreamGroups(function(){loadStream(c.id)})}})}function cancelStreamGroup(){$("#newGroup").remove()}function newStreamGroup(){var a=$("#menusubs input:first-child");if(a.length==0){$("#menusubs").prepend("<div id='newGroup'><input size='8' type='text' value=''>                <button onclick='saveStreamGroup()'>S</button><button onclick='cancelStreamGroup()'>C</button></div>");a=$("#menusubs input:first-child")}a.focus();a.on("keyup",function(b){if((b.keyCode||b.which)==13){saveStreamGroup()}if((b.keyCode||b.which)==27){cancelStreamGroup()}})}function showAll(){selectedStream.h_filter_by=FILTER_SHOW_ALL;clearView();loadEntries(0)}function showUnreadOnly(){selectedStream.h_filter_by=FILTER_BY_UNREAD;clearView();loadEntries(0)}function streamSort(a){selectedStream.h_sort_by=a;clearView();loadEntries(0)}function saveReaderSettings(){$.get(baseUrl+apiUrlSaveReaderSettings,queryGroups,function(b,a){})}function closeMenu(){$("#leftbar").hide();$("#stream_content").removeClass("col-sm-offset-3").removeClass("col-md-offset-2").removeClass("col-sm-9").removeClass("col-md-10");$(".show_menu").show()}function showMenu(){$("#leftbar").show();$("#stream_content").addClass("col-sm-offset-3").addClass("col-md-offset-2").addClass("col-sm-9").addClass("col-md-10");$(".show_menu").hide()}function reloadSelected(){location.reload()}function renderContentStart(){$("#stream_entries").html($("#content_start_all").html())};