function initCollections(){collectionTmpl=Handlebars.compile($("#collections_tmpl").html()),feedEntriesTmpl=Handlebars.compile($("#feeds_tmpl").html());var a={};collectionsIds=[],$.get(baseUrl+apiCollectionsList,a,function(a,b){if(collections=a.entries,a.entries)for(var c=0;c<a.entries.length;c++){var d=a.entries[c];collectionsIds[collectionsIds.length]=d.l_collection_id,collectionsById[d.l_collection_id]=d,$("#collections-content .wrapper").append(collectionTmpl({c:d}))}})}function toggleFeedsCollection(a,b){var c=$("#feeds_"+b);if(c.is(":visible"))c.hide();else{var d={};d.ids=b,$.get(baseUrl+apiCollectionsEntries,d,function(a,b){c.html(feedEntriesTmpl({entries:a.entries})),c.show()})}}function setBaseUrl(a){baseUrl=a}function cut(a,b){return a&&a.length>b?a.substring(0,b)+"...":a}function toggleCheckbox(a){$(a).prop("checked",!$(a).prop("checked"))}function hideModal(){$(MODALBOX_SELECTOR).keydown(null),$(MODALBOX_SELECTOR).hide(),closeModalCallback&&closeModalCallback()}function modalError(a){$("#modalTitle").css("background-color","red"),$("#modalTitle").text(a)}function showModal(a,b,c,d){$("#modalTitle").css("background-color",""),$(MODALBOX_SELECTOR).show(),$("#modalTitle").text(a);var e=$(b);e.remove(),$("#modalContent").html(e.html());$(MODALBOX_SELECTOR),$(".modal-header button");$(".modal-header button").focus(),this.closeModalCallback=c,$(MODALBOX_SELECTOR).keydown(function(a){27==a.keyCode&&hideModal(),$(MODALBOX_SELECTOR).is(":visible")&&13==a.keyCode&&$(".modal-footer .btn-primary").is(":visible")&&$(".modal-footer .btn-primary").click()}),d&&d($(MODALBOX_SELECTOR))}function toogleSmallMenu(){$("#nav").toggle(),$("#content").css("margin-top","50px")}function closeLeftBar(){$("#leftbar").hide(),$(document).off("keyup.leftbar"),$(document).off("mousedown.leftbar")}function openLeftBar(){$("#leftbar").toggle(),$("#leftbar").is(":visible")&&($(document).on("keyup.leftbar",function(a){27==a.keyCode&&closeLeftBar()}),$(document).on("mousedown.leftbar",function(a){var b=$("#leftbar");b.is(a.target)||"logo"==a.target.id||0!==b.has(a.target).length||closeLeftBar()}))}function initProfiles(){registerOnProfileSelected(function(){renderProfiles()}),registerOnProfileDataChange(function(){renderProfiles()}),$.getJSON(baseUrl+apiUrlProfileList,"",function(a){profiles={},a.entries&&(profiles=a.entries,triggerOnProfilesAvailable())})}function renderProfiles(){profilesTmpl||(profilesTmpl=Handlebars.compile($("#left-menu-profiles-tmpl").html())),$("#profiles .content").html(profilesTmpl({profiles:profiles}))}function registerOnProfileSelected(a){onProfileSelectedListeners.push(a)}function registerOnProfilesAvailable(a){onProfilesAvailableListeners.push(a)}function registerOnProfileDataChange(a){onProfileDataChangedListeners.push(a)}function triggerOnProfilesAvailable(){for(var a=0;a<onProfilesAvailableListeners.length;a++)onProfilesAvailableListeners[a](profiles)}function triggerOnProfileSelected(a){for(var b=0;b<onProfileSelectedListeners.length;b++)onProfileSelectedListeners[b](a)}function triggerOnProfileDataChanged(){for(var a=0;a<onProfileDataChangedListeners.length;a++)onProfileDataChangedListeners[a](profiles)}function setSessionProfile(a,b){$.get(baseUrl+"/pages/set_profile.jsp?id="+a,function(a){b&&b(a)})}function selectProfile(a,b){if(b&&(window.location.hash=""),0!=a){for(var c=0;c<profiles.length;c++)profiles[c].l_profile_id==a&&(selectedProfile=profiles[c]);0==selectedProfile.l_profile_id,$(".profileColor").css("background-color","#"+selectedProfile.s_color),$(".profile-color").css("color","#"+selectedProfile.s_color),$("#profile").text(selectedProfile.s_profile_name),$("#profiles").hide(),setSessionProfile(a,function(){triggerOnProfileSelected(selectedProfile)})}}function renameProfile(a,b,c){a==$("#profile").attr("data-id")&&($("#profile").attr("data-id",a),$("#profile").text(b));for(var d=0;d<profiles.length;d++)if(profiles[d].l_profile_id==a)return profiles[d].s_profile_name=b,c&&(profiles[d].s_color=c),void triggerOnProfileDataChanged()}function showCreateNewProfile(){showModal("Create new Profile","#div_new_profile",function(){$("#loader").css("background-color","#"+selectedProfile.s_color)}),$("input[name=profile_name]").focus();var a=$("input[name=picker]");a.change(changeProfileColor);var b=new jscolor.color(a.get(0),{slider:!1,pickerFaceColor:"transparent",pickerFace:3,pickerBorder:0,pickerInsetColor:"black"});b.fromString("99FF33")}function changeProfileColor(a){$("#loader").css("background-color","#"+a.target.value)}function closeNewProfile(){hideModal()}function createNewProfile(a,b){var c=$("input[name="+a+"]"),d=$("input[name="+b+"]"),e={};e.n=c.val(),e.c=d.val(),$.getJSON(baseUrl+"/api/v1/user/profiles/new",e,function(a){return a.success?(setSessionProfile(a.profileid,function(){location.reload()}),void hideModal()):($("#modal_error_text").text("Couldn't add profile. "+a.error),void $("#modal_error").show())})}function showShareCollection(){showModal("Share "+selectedStream.s_stream_name,"#div_share_collection",function(){},function(a){$("#collectionName").val(selectedStream.s_stream_name)})}function shareCollection(){var a={};a.id=selectedStream.l_stream_id,a.name=$("#collectionName").val(),a.description=$("#collectionDesc").val(),$.post(baseUrl+"/"+apiShareCollection,a,function(a,b){a.error?modalError(a.error):a.success&&hideModal()})}function initReader(){readerHome=baseUrl+"/reader",setupTemplates(),setupRoutes(),tmplOptions.id=TEMPLATE_ID_STREAM,initReaderSubscriptions(),setupEvents()}function setupEvents(){window.onscroll=function(a){if(selectedStream.h_filter_by==FILTER_BY_UNREAD&&topUnread){var b=topUnread.get(0);if("function"==typeof b.getBoundingClientRect){var c=b.getBoundingClientRect();if(c.top<70){lastRead!=topUnread&&(markRead(topUnread.get(0)),lastRead=topUnread);var d=topUnread.next(".news");1==d.length&&(lastTopY=c.top,topUnread=d)}}}},registerOnEntriesLoadedListeners(function(a){a&&a.entries&&updateNewsListView()})}function setupTemplates(){Handlebars.registerPartial("stream-options",$("#stream-options").html()),streamGroupsTmpl=Handlebars.compile($("#stream_groups_tmpl").html()),viewLineTmpl=Handlebars.compile($("#news_line_tmpl").html()),viewMagTmpl=Handlebars.compile($("#news_mag_tmpl").html()),viewNewsTmpl=Handlebars.compile($("#news_stream_tmpl").html()),entriesTmpl=viewLineTmpl,sourceHeaderTmpl=Handlebars.compile($("#source-header-tmpl").html()),recentlyReadHeaderTmpl=Handlebars.compile($("#recently_read_header_tmpl").html()),simpleViewHeaderTmpl=Handlebars.compile($("#simple_view_header_tmpl").html()),contentAllRead=Handlebars.compile($("#content_all_read").html()),contentEmptySource=Handlebars.compile($("#content_empty_source").html()),pageUnknownTmpl=Handlebars.compile($("#content_unknown").html())}function setupRoutes(){router=(new Router).init(),router.on("/f/:feedid",loadStream),router.on("/r/:feedid",reloadStream),router.on("/v/a",loadAll),router.on("/v/r",loadRecentlyRead),router.on("/v/s",loadSaved),router.on("/s/:sourceid",loadSource)}function apiMarkRead(a,b){var c={};c.e=a,c.sid=selectedStream.l_stream_id,c.c=selectedStream.l_gr_unread,$.get(baseUrl+apiUrlMarkRead,c,function(a,c){b&&b(a,c)})}function setProfile(a){this.profileId=a.profileId,queryGroups.showUnreadOnly=a.settings.showUnreadOnly,1!=a.settings.sortAz&&2!=a.settings.sortAz||(queryGroups.sortByAlphabet=a.settings.sortAz),1!=a.settings.sortUnread&&2!=a.settings.sortUnread||(queryGroups.sortByUnread=a.settings.sortUnread)}function setEntriesPerPage(a){entriesPerPage=a}function registerOnEntriesLoadedListeners(a){onEntriesLoadedListeners.push(a)}function triggerOnEntriesLoadedListeners(a){for(var b=0;b<onEntriesLoadedListeners.length;b++)onEntriesLoadedListeners[b](a)}function registerChangeViewListener(a){onViewChangedListeners.push(a)}function triggerChangeViewListeners(a){for(var b=0;b<onViewChangedListeners.length;b++)onViewChangedListeners[b](a)}function displayStreamHeader(a){streamGroupHeaderTmpl||(streamGroupHeaderTmpl=Handlebars.compile($("#stream-header-tmpl").html())),$("#stream-header .content").html(streamGroupHeaderTmpl({options:a,stream:selectedStream}))}function showOnlyWithUnread(a){queryGroups.showUnreadOnly=a,runQuery(),saveReaderSettings()}function sortByAlphabet(a){queryGroups.sortByAlphabet=a,queryGroups.sortByUnread=0,runQuery(),saveReaderSettings()}function sortByUnread(a){queryGroups.sortByUnread=a,queryGroups.sortByAlphabet=0,runQuery(),saveReaderSettings()}function runQuery(){var a=jlinq.from(streamGroups);queryGroups.showUnreadOnly&&a.greater("l_gr_unread",0),0!=queryGroups.sortByAlphabet&&a.sort((1==queryGroups.sortByAlphabet?"-":"")+"s_stream_name"),0!=queryGroups.sortByUnread&&a.sort((1==queryGroups.sortByUnread?"-":"")+"l_gr_unread"),filteredStreamGroups=a.select(),renderStreamGroups(filteredStreamGroups)}function renderStreamGroups(a){$("#menusubs").html(streamGroupsTmpl({groups:a})),selectDom("e_"+selectedStream.l_stream_id)}function getUnreadCount(a,b,c){for(var d="",e=0;e<a.length;e++)d+=a[e].l_stream_id+",";if(0==d.length){if(!c)return;c()}void 0==b&&(b=0);var f={};f.sid=d.slice(0,-1),f.nc=b,$.getJSON(baseUrl+apuUrlStreamsUnreadCount,f,function(a,b){for(var d=0;d<streamGroups.length;d++)for(var e=0;e<a.entries.length;e++)if(streamGroups[d].l_stream_id==a.entries[e].id){streamGroups[d].l_gr_unread=a.entries[e].count;break}runQuery(),void 0!=c&&c()})}function refreshUnread(){getUnreadCount(streamGroups,1)}function getStreamGroups(a){var b={};b.views=!0,$.getJSON(baseUrl+apiUrlStreamsList,b,function(b){streamGroups=b,getUnreadCount(streamGroups,0,function(){a&&a(streamGroups,filteredStreamGroups)})})}function closeAllHeaderTools(){return $("#header_subscriptions").css("display","none"),!1}function showRename(a){$("#span_"+a).hide(),$("#div_"+a).show(),input=$("#txt_"+a),txt=input.val(),input.val(""),input.focus(),input.val(txt)}function toggleHeaderTool(a){switch(a){case"subscriptions":$("#header_subscriptions").toggle(),renderSubscriptions()}}function showImport(){showModal("Add new feed to '"+selectedStream.s_stream_name+"'","#div_add_subscription",function(){})}function importSingleFeed(){var a={};a.n=$("input[name=sName]:visible").val(),a.u=$("input[name=sUrl]:visible").val(),a.sid=selectedStream.l_stream_id,$.getJSON(baseUrl+apiUrlSubscriptionsAdd,a,function(a){a.success?(hideModal(),loadStream(selectedStream.l_stream_id)):a.error&&modalError(a.error)})}function showDeleteStream(){$("#modalBox").attr("data-stream_id",selectedStream.l_stream_id),showModal("Delete Stream","#div_delete_stream")}function confirmClearRecentlyRead(){confirm("This will clear all recently read articles for this profile. Are you sure?")&&$.getJSON(baseUrl+apiUrlRecentlyReadClear,{},function(a){a.count>=0&&loadRecentlyRead()})}function deleteStream(a){if(confirm("Delete stream from all profiles?")){var b={};b.sid=a,b.dp=!0,$.getJSON(baseUrl+apiUrlStreamDelete,b,function(a){a.count>0&&location.assign(readerHome)})}return!1}function updateStreamGroupsList(a,b){for(var c=0;c<streamGroups.length;c++)if(streamGroups[c].i==a){streamGroups[c].n=b;break}$("#menusubs").html(streamGroupsTmpl({groups:streamGroups}))}function sendActionEntry(a,b,c){var d={};d.id=a,d.act=b,$.getJSON(baseUrl+apiUrlEntriesEntry,d,function(a){c(a)})}function removeEntry(a){sendActionEntry(a,"r",function(a){})}function saveEntry(a,b){var c=$(a).find("i");c&&c.hasClass("fa-bookmark-o")?($(c).removeClass("fa-bookmark-o").addClass("fa-bookmark"),sendActionEntry(b,"s",function(a){})):c&&c.hasClass("fa-bookmark")&&($(c).removeClass("fa-bookmark").addClass("fa-bookmark-o"),sendActionEntry(b,"r",function(a){}))}function renameSubscription(){var a=$("#txt_subscription_rename").val(),b=$("#txt_subscription_rename").attr("data-value");saveSubscription(b,a,function(b){b.count>0&&($("#div_subscription_rename").hide(),$("#span_subscription_rename").text(a),$("#span_subscription_rename").show())})}function renameStreamGroup(){var a={};a.sid=selectedStream.l_stream_id,a.sn=$("#txt_stream_rename").val(),$.getJSON(baseUrl+apiUrlStreamsRename,a,function(b){b.count>0&&(selectedStream.s_stream_name=a.sn,displayStreamHeader(),updateStreamGroupsList(a.sid,a.sn))})}function fetchFavIcos(){uniqueSources=[];for(var a=0;a<streamEntries.length;a++){var b=streamEntries[a].l_xml_id;uniqueSources.indexOf(b)>=0||uniqueSources.push(b)}var c={};c.ids=uniqueSources.toString(),c.qtype=1,$.getJSON(baseUrl+apiUrlSourcesGet,c,function(a){a&&a.entries&&a.entries.forEach(function(a,b,c){""!=a.s_link?$("img[name=favico_"+a.l_xml_id+"]").attr("src",baseFavicoDomain+a.s_link):a.s_xml_url&&$("img[name=favico_"+a.l_xml_id+"]").attr("src",baseFavicoDomain+a.s_xml_url)})})}function fetchNewsData(a,b){var c={};c.entries="",c.img=a,c.cnt=b,c.ml=CONTENT_MAX_LEN;for(var d=0;d<streamEntries.length;d++)c.entries+=streamEntries[d].l_entry_id,d+1!=streamEntries.length&&(c.entries+=",");$.getJSON(baseUrl+apiUrlEntriesData,c,function(c){if(c.entries)for(var d=0;d<c.entries.length;d++){if(a&&c.entries[d])if(""==c.entries[d].s_thumb_url)$("#img_"+c.entries[d].l_entry_id).remove();else if(currentView==VIEW_STREAM){var e=document.createElement("img");e.src=c.entries[d].s_thumb_url,$("#img_"+c.entries[d].l_entry_id).html(e)}else currentView==VIEW_MAGAZINE&&$("#img_"+c.entries[d].l_entry_id).css("background","url("+c.entries[d].s_thumb_url+") no-repeat top center");b&&c.entries[d].content&&$("#cnt_"+c.entries[d].l_entry_id).html(c.entries[d].content)}})}function markRead(a){a.className=a.className+" read",apiMarkRead($(a).attr("data-id"),function(a,b){a.count&&(selectedStream.l_gr_unread--,updateUnread(),runQuery())})}function apiStreamRead(a,b){var c={};c.sid=a,c.t=renderTime,$.getJSON(baseUrl+apiUrlStreamsMarkAllRead,c,function(a,c){b&&b(a)},"json")}function markAllRead(){$(".news").not(".read").each(function(a,b){$(b).addClass("read")}),apiStreamRead(selectedStream.l_stream_id,function(a){}),selectedStream.l_gr_unread=0,clearViewAndData(),updateUnread(),updateNewsListView(),runQuery(),$(".mark_all_read").hide(),moveTop()}function moveTop(){$(window).scrollTop(0)}function setLineView(){currentView=VIEW_LIST,clearView(),loadEntries(0)}function setMagazineView(){currentView=VIEW_MAGAZINE,clearView(),loadEntries(0)}function setStreamView(){currentView=VIEW_STREAM,clearView(),loadEntries(0)}function updateNewsListView(){if(setViewOptions(),updateNewsContentPane(streamEntries.length),updateHeaderRightTools(),tmplOptions.id==TEMPLATE_ID_STREAM){var a={};a.sid=selectedStream.l_stream_id,a.filter=selectedStream.h_filter_by,a.sort=selectedStream.h_sort_by,a.v=currentView,a.c=selectedStream.l_gr_unread,$.getJSON(baseUrl+apiUrlStreamUpdate,a,function(a,b){},"json")}else{var a={};switch(a.tmpl=tmplOptions.id,a.v=currentView,tmplOptions.id){case TEMPLATE_ID_SAVED:selectedProfile.saved_settings.view=currentView;break;case TEMPLATE_ID_ALL:selectedProfile.all_settings.view=currentView;break;case TEMPLATE_ID_RECENTLY_READ:selectedProfile.rr_settings.view=currentView}$.getJSON(baseUrl+apiUrlSaveModulesSettings,a,function(a,b){},"json")}void 0==topUnread&&(topUnread=$(".news").first()),fetchFavIcos(),currentView!=VIEW_MAGAZINE&&currentView!=VIEW_STREAM||fetchNewsData(!0,!0),triggerChangeViewListeners(currentView)}function updateHeaderRightTools(){$(".mark_all_read").hide(),selectedStream.h_filter_by==FILTER_SHOW_ALL?($("#show_unread").css("text-decoration","none"),$("#show_all").css("text-decoration","underline")):selectedStream.h_filter_by==FILTER_BY_UNREAD&&($("#show_unread").css("text-decoration","underline"),$("#show_all").css("text-decoration","none"),streamEntries.length>0&&$(".mark_all_read").show()),selectedStream.h_sort_by==SORT_NEW_FIRST?($("#oldest_first").css("text-decoration","none"),$("#newset_first").css("text-decoration","underline")):selectedStream.h_filter_by==SORT_OLD_FIRST&&($("#oldest_first").css("text-decoration","underline"),$("#newset_first").css("text-decoration","none"))}function setViewOptions(){switch($("#icon_view_line").removeClass("icon-view-bgcolor"),$("#icon_view_mag").removeClass("icon-view-bgcolor"),$("#icon_view_stream").removeClass("icon-view-bgcolor"),currentView){case VIEW_LIST:tmplOptions.sourceLen=11,$("#icon_view_line").addClass("icon-view-bgcolor"),entriesTmpl=viewLineTmpl;break;case VIEW_MAGAZINE:$("#icon_view_mag").addClass("icon-view-bgcolor"),tmplOptions.sourceLen=50,entriesTmpl=viewMagTmpl;break;default:case VIEW_STREAM:$("#icon_view_stream").addClass("icon-view-bgcolor"),tmplOptions.sourceLen=50,entriesTmpl=viewNewsTmpl,currentView=VIEW_STREAM}screen.width<1200&&(tmplOptions.sourceLen=10),screen.width<1e3&&(tmplOptions.sourceLen=8,tmplOptions.showSource=!1),currentView==VIEW_LIST&&screen.width<450&&(tmplOptions.showIco=!1,tmplOptions.titleLen=35),tmplOptions.leftSize=2,tmplOptions.midSize=9,tmplOptions.showSource||(tmplOptions.leftSize--,tmplOptions.midSize++),tmplOptions.showIco||(tmplOptions.leftSize--,tmplOptions.midSize++),selectedStream.h_view_mode=currentView}function updateNewsContentPane(a){if($("#load-more").hide(),selectedStream.h_filter_by==FILTER_BY_UNREAD?$("#mark-all-read").show():$("#mark-all-read").hide(),0==a||void 0==a){if($("#mark-all-read").hide(),$("#to-top").hide(),tmplOptions.id==TEMPLATE_ID_SOURCE)return void(0==streamPage&&$("#stream-entries").html(contentEmptySource({id:selectedStream.l_stream_id})));tmplOptions.id==TEMPLATE_ID_ALL?renderContentStart():tmplOptions.id==TEMPLATE_ID_SAVED?$("#stream-entries").html($("#content_start_saved").html()):tmplOptions.id==TEMPLATE_ID_RECENTLY_READ?$("#stream-entries").html($("#content_start_recently_read").html()):0==streamPage&&0!=streamSubscriptions.length?$("#stream-entries").html(contentAllRead({name:selectedStream.s_stream_name})):$("#stream-entries").html($("#content_start_source").html())}else $("#to-top").show(),streamEntries.length==entriesPerPage&&($("#load-more").show(),moreAvailable=!0),$("#stream-entries").append(entriesTmpl({tmplOptions:tmplOptions,midSize:tmplOptions.midSize,entries:streamEntries}))}function resetTemplate(a,b,c){renderTime=(new Date).getTime(),closeAllHeaderTools(),tmplOptions.id=a,tmplOptions.showIco=b,tmplOptions.showSource=c,selectedStream={},clearView(),moveTop()}function clearContent(){selectedStream={},streamGroups={},filteredStreamGroups={},position=0,$("#menusubs").html(""),$("#stream_header").html(""),$("#stream_config").hide(),clearViewAndData()}function clearView(){topUnread=null,pendingRequest=!1,$("#stream-entries").html(""),$("#stream_more").hide(),$(".mark_all_read").hide()}function clearViewAndData(){clearView(),streamPage=0,streamEntries={},updateNewsListView()}function loadStream(a){this.streamId=a,apiCurrentStreamsFeed=apiUrlStreamsFeed,resetTemplate(TEMPLATE_ID_STREAM,!0,!0);for(var b=0;b<streamGroups.length;b++)streamGroups[b].l_stream_id==a&&(selectedStream=streamGroups[b]);currentView=selectedStream.h_view_mode,fetchAllStreamSubscriptions(a),displayStreamHeader({showMarkAllRead:!0,showAdd:!0,showSubscriptions:!1,showFilter:!0,showRanking:!0,showDeleteStream:!0}),loadEntries(0)}function loadAll(){currentView=selectedProfile.all_settings.view,apiCurrentStreamsFeed=apiUrlStreamsFeedAll,resetTemplate(TEMPLATE_ID_ALL,!0,!0),selectDom("mAll"),$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries,triggerOnEntriesLoadedListeners(streamEntries)}),selectedStream.s_stream_name="All",selectedStream.l_stream_id=0,selectedStream.l_view=TEMPLATE_ID_ALL,displayStreamHeader()}function selectDom(a){$(".gselected").removeClass("gselected"),$("#"+a).addClass("gselected")}function loadRecentlyRead(){currentView=selectedProfile.rr_settings.view,apiCurrentStreamsFeed=apiUrlStreamsFeedRecent,resetTemplate(TEMPLATE_ID_RECENTLY_READ,!0,!0),selectDom("mRr"),$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries,triggerOnEntriesLoadedListeners(streamEntries)}),selectedStream.s_stream_name="Recently read",selectedStream.l_stream_id=0,selectedStream.l_view=TEMPLATE_ID_RECENTLY_READ,displayStreamHeader({showClearRecentlyRead:!0})}function loadSaved(){currentView=selectedProfile.saved_settings.view,apiCurrentStreamsFeed=apiUrlStreamsFeedSaved,resetTemplate(TEMPLATE_ID_SAVED,!0,!0),selectDom("mSaved"),$.getJSON(baseUrl+apiCurrentStreamsFeed,{},function(a){streamEntries=a.entries,triggerOnEntriesLoadedListeners(streamEntries)}),selectedStream.s_stream_name="Saved",selectedStream.l_stream_id=0,selectedStream.l_view=TEMPLATE_ID_SAVED,displayStreamHeader({showClearSaved:!0})}function loadSource(a){resetTemplate(TEMPLATE_ID_SOURCE,!1,!1),apiCurrentStreamsFeed=apiUrlSourceId;var b={};b.id=a,$.getJSON(baseUrl+apiUrlSourcesGet,b,function(a){$("#stream-header .content").html(sourceHeaderTmpl(a))},"json");var b={};b.sid=a,$.getJSON(baseUrl+apiUrlSubscriptionsGet,b,function(a){});var b={};b.id=a,selectedStream.l_stream_id=a,$.getJSON(baseUrl+apiUrlSourceId,b,function(a){streamEntries=a.entries,updateNewsListView()})}function loadMore(){$("#stram-footer").hide(),moreAvailable&&loadEntries(++streamPage)}function updateUnread(){var a=selectedStream.l_gr_unread;a<0&&(selectedStream.l_gr_unread=0),$("#unread").text(a),$("#footer_unread").text(a),0==a&&queryGroups.showUnreadOnly&&$("#e_"+selectedStream.l_stream_id).hide()}function loadEntries(a){if(!pendingRequest){streamPage=a,pendingRequest=!0;var b={};if(b.id=selectedStream.l_stream_id,b.page=a,b.filter=selectedStream.h_filter_by,b.sort=selectedStream.h_sort_by,b.filter==FILTER_BY_UNREAD){var c=$(".news").not(".read").length;b.offset=c}$.getJSON(baseUrl+apiCurrentStreamsFeed,b,function(a,b){streamEntries=a.entries,void 0!=a.unread?(selectedStream.l_gr_unread=a.unread,updateUnread()):updateUnread(),runQuery(),triggerOnEntriesLoadedListeners(a.entries),pendingRequest=!1},"json")}}function loadUnknown(){$("#stream-entries").html(pageUnknownTmpl())}function reloadStream(){clearView(),loadEntries(0)}function cancelStreamGroup(){$("#newGroup").remove()}function newStreamGroup(){var a=$("#menusubs input:first-child");0==a.length&&($("#menusubs").prepend("<div id='newGroup'><input size='8' type='text' value=''>                <button onclick='saveStreamGroup()'>S</button><button onclick='cancelStreamGroup()'>C</button></div>"),a=$("#menusubs input:first-child")),a.focus(),a.on("keyup",function(a){13==(a.keyCode||a.which)&&saveStreamGroup(),27==(a.keyCode||a.which)&&cancelStreamGroup()})}function showAll(){selectedStream.h_filter_by=FILTER_SHOW_ALL,clearView(),loadEntries(0)}function showUnreadOnly(){selectedStream.h_filter_by=FILTER_BY_UNREAD,clearView(),loadEntries(0)}function streamSort(a){selectedStream.h_sort_by=a,clearView(),loadEntries(0)}function saveReaderSettings(){$.get(baseUrl+apiUrlSaveReaderSettings,queryGroups,function(a,b){})}function closeMenu(){$("#leftbar").hide(),$("#stream_content").removeClass("col-sm-offset-3").removeClass("col-md-offset-2").removeClass("col-sm-9").removeClass("col-md-10"),$(".show_menu").show()}function showMenu(){$("#leftbar").show(),$("#stream_content").addClass("col-sm-offset-3").addClass("col-md-offset-2").addClass("col-sm-9").addClass("col-md-10"),$(".show_menu").hide()}function reloadSelected(){location.reload()}function renderContentStart(){$("#stream-entries").html($("#content_start_all").html())}function toggleEditTools(a,b){$("#edit_tools").toggle(),$("#edit_tools").is(":visible")?$(a).html("&laquo;&laquo;"):$(a).html(b+"&nbsp;&raquo;&raquo;")}function initReaderSubscriptions(){allSubsTmpl=Handlebars.compile($("#all_subscriptions_tmpl").html()),subsTmpl=Handlebars.compile($("#subscribed_tmpl").html()),$("#"+idSearchAll).on("keyup",function(a){27==(a.keyCode||a.which),filterByKeywordAll(a.target.value),runQuery()}),$("#"+idSearchSubs).on("keyup",function(a){27==(a.keyCode||a.which),filterByKeywordSubs(a.target.value),runQuery()}),fetchAllSubscriptions()}function renderAllReaderSubscriptions(a){$("#all_count").text(a.length),$("#all_subscriptions").html(allSubsTmpl({subscriptions:a}))}function clearStreamSubscriptions(){for(;streamSubscriptions.length>0;)streamSubscriptions.pop();for(;namedStreamSubscriptions.length>0;)namedStreamSubscriptions.pop()}function fetchAllStreamSubscriptions(a,b){getAllStreamSubscriptions(a,function(a){clearStreamSubscriptions(),$("#stream_count").text(a.entries.length),a&&a.entries&&(streamSubscriptions=a.entries,a.entries.forEach(function(a,b,c){namedStreamSubscriptions["s"+a.l_subs_id]={},namedStreamSubscriptions["s"+a.l_subs_id].name=a.s_subs_name,namedStreamSubscriptions["s"+a.l_subs_id].xml_id=a.l_xml_id})),b&&b(a)})}function renderReaderSubscriptions(a){$("#stream_count").text(a.length),$("#subscribed").html(""),$("#subscribed").html(subsTmpl({subscriptions:a}))}function fetchAllSubscriptions(a){apiGetAllSubscriptions(function(b){$("#all_count").text(subscriptions.length);for(var c=subscriptions.length-1;c>=0;c--)namedStreamSubscriptions["s"+subscriptions[c].l_subs_id]&&subscriptions.splice(c,1);a&&a(b)})}function renderSubscriptions(){filterByKeywordAll(),filterByKeywordSubs()}function removeSubscription(a){var b={};b.sid=selectedStream.l_stream_id,b.sui=a,$.getJSON(baseUrl+apiSubscriptionRemoveFromStream,b,function(b){b.count>0&&($("#subscription_r_"+a).remove(),$("#subscription_r_"+a).empty(),$("#reload").show())})}function addSubscription(a){var b={};b.sid=selectedStream.l_stream_id,b.sui=a,$.getJSON(baseUrl+apiSubscriptionAddToStream,b,function(b){b.count>0&&($("#subscription_l_"+a).remove(),$("#subscription_l_"+a).empty(),$("#reload").show())})}function filterByKeywordAll(a){queryAll.keyword=a?a:$("#"+idSearchAll).val(),runReaderQuery(subscriptions,queryAll,!0)}function filterByKeywordSubs(a){querySubs.keyword=a?a:$("#"+idSearchSubs).val(),runReaderQuery(streamSubscriptions,querySubs,!1)}function runReaderQuery(a,b,c){var d=jlinq.from(a).sort(b.sortBy);b.keyword&&b.keyword.length>0&&d.contains("s_subs_name",b.keyword),c?renderAllReaderSubscriptions(d.select()):renderReaderSubscriptions(d.select())}function initSettings(){profilesSettingsTmpl=Handlebars.compile($("#all_profiles_settings_tmpl").html());var a=(new Router).init();a.on("/v/:panel",loadSettingsView),a.on("/v/:panel/:val",loadSettingsView),r=a.getRoute()}function setupProfileView(a){$("#profile_settings_list").html(profilesSettingsTmpl({profiles:a})),loadColorPickers()}function loadSettingsView(a,b){$("#content_panel").children().each(function(a,b){"error"!=b.id&&"info"!=b.id&&$(b).hide()}),$("#"+a).show()}function showMessage(a,b){return b&&""!=b?($("#"+a+"_text").text(b),void $("#"+a).show()):void $("#"+a).hide()}function showError(a){showMessage("error",a)}function showInfo(a){showMessage("info",a)}function loadColorPickers(){$("#profile_settings_list").children("div").each(function(a,b){var c=$("#picker_"+b.id);c.change(changeProfileColor);var d=new jscolor.color(c.get(0),{slider:!0,pickerFaceColor:"transparent",pickerMode:"HSV",pickerFace:1,pickerBorder:0,pickerInsetColor:"black"});d.fromString(c.attr("data-color"))})}function deleteProfile(a){if(confirm("Are you sure? Deleting a profile means:\n* All recently read and saved information for this profile is deleted. \n* Any stream groups not used by other profiles are deleted.")){showError("");var b={};b.pid=a,$.getJSON(baseUrl+"/api/v1/user/profiles/delete",b,function(a){a.count>0?location.reload():a.error&&showError(a.error)})}}function initSubscriptions(){setupTemplates();var a=(new Router).init();a.on("/view/:id",showSubscriptionDetails),sr=a.getRoute()}function setupSubsTemplates(){susbcriptionsHome=baseUrl+"/pages/susbcriptions.jsp",allSubscriptionsTmpl=Handlebars.compile($("#all_subscriptions_tmpl").html()),profileStreamGrpTmpl=Handlebars.compile($("#profile_stream_groups_tmpl").html())}function initialRenderAll(){query.keyword=$("#searchQuery").val(),query.showOnlyInactive=$("input[name=onlyinactive]").prop("checked"),runQuery(!0)}function registerOnAllSubscriptionsAvailable(a){onAllSubscriptionsAvailableListeners.push(a)}function triggerOnAllSubscriptionsAvailable(){for(var a=0;a<onAllSubscriptionsAvailableListeners.length;a++)onAllSubscriptionsAvailableListeners[a](subscriptions)}function checkFilter(){query.showOnlyInactive=$("input[name=onlyinactive]").prop("checked"),query.showZeroSources=$("input[name=withoutentries]").prop("checked"),runQuery(!0)}function sortBy(a,b){"desc"==b&&(a="-"+a),query.sortBy=a,runQuery(!0)}function filterByKeyword(){var a=$("#searchQuery");query.keyword=a.val(),runQuery(!0)}function runSubsQuery(a){jlinqQuery=jlinq.from(subscriptions).sort(query.sortBy),query.showOnlyInactive&&jlinqQuery.equals("b_gaveup",!0),query.showZeroSources&&jlinqQuery.equals("i_total_entries",0),query.keyword.length>0&&jlinqQuery.contains("s_subs_name",query.keyword);var b=jlinqQuery.select();a&&renderAllSubscriptions(b),showSubscriptionDetails(b.length>0?b[0].l_subs_id:0)}function renameSubscription(a,b){for(var c=0;c<subscriptions.length;c++)if(subscriptions[c].l_subs_id==a){subscriptions[c].s_subs_name=b;break}runQuery(!0)}function saveSubscription(a,b,c){var d={};d.id=a,d.n=b,$.getJSON(baseUrl+"/api/v1/user/subscriptions/set",d,function(d){return c?c(d):void(d&&d.count>0&&renameSubscription(a,b))})}function loadDefaultView(){subscriptions&&subscriptions.length>0&&showSubscriptionDetails(subscriptions[0].l_subs_id)}function loadSelectedView(){showSubscriptionDetails(selectedSubscriptionId)}function renderAllSubscriptions(a){$("#all_subscriptions_list").html(allSubscriptionsTmpl({subscriptions:a})),$("#count").text(a.length)}function showSubscriptionDetails(a){$("#profile_stream_groups").html(""),queryData={},queryData.id=a,$.getJSON(baseUrl+"/api/v1/user/subscriptions/get",queryData,function(a){}),getSubscriptionStreamProfiles(a)}function apiGetAllSubscriptions(a){a&&registerOnAllSubscriptionsAvailable(a),$.getJSON(baseUrl+"/api/v1/user/subscriptions/list",{},function(a){subscriptions=a.entries;for(var b=0;b<subscriptions.length;b++)subscriptionsIdx.push(subscriptions[b].l_xml_id);triggerOnAllSubscriptionsAvailable()})}function getSubscriptionStreamProfiles(a){if(a){var b={};b.id=a,$.getJSON(baseUrl+"/api/v1/user/subscriptions/withprofile",b,function(a){var b={};a.forEach(function(a,c,d){b[a.s_stream_name]||(b[a.s_stream_name]={},b[a.s_stream_name].l_stream_id=a.l_stream_id,b[a.s_stream_name].profiles=new Array),b[a.s_stream_name].profiles.push({l_profile_id:a.l_profile_id,s_profile_name:a.s_profile_name})});for(k in b);})}}function getAllStreamSubscriptions(a,b){var c={};c.sid=a,$.getJSON(baseUrl+"/api/v1/user/subscriptions/list",c,function(a){b(a)})}function addSubscriptionToNewStream(a){}function removeFromStreamGroup(a,b){var c={};c.sui=a,c.sid=b,$.getJSON(baseUrl+"/api/v1/user/subscriptions/removefromstream",c,function(b){b.count>0&&showSubscriptionDetails(a)})}function removeStreamFromProfile(a,b){var c={};c.pid=a,c.sid=b}function removeFromSubscriptionsArray(a,b){for(var c=0;c<subscriptions.length;c++)if(subscriptions[c][a]==b)return void subscriptions.splice(c,1)}function removeSubscription(a){var b={};b.sid=a,$.getJSON(baseUrl+"/api/v1/user/subscriptions/remove",b,function(b){b.count>=0&&(removeFromSubscriptionsArray("l_subs_id",a),runQuery(!0,!0))})}var COLUMNS=3,MODAL_COLLECTION_ADD="modal_collection_add",currentColumn=0,apiCollectionsList="/api/v1/collections/list",apiCollectionsEntries="/api/v1/collections/entries",apiCollectionAdd="/api/v1/collections/add",baseFavicoDomain="http://www.google.com/s2/favicons?domain=",collections={},collectionsIds=[],collectionsById={},collectionTmpl={},feedEntriesTmpl={};Handlebars.registerHelper("favico",function(a){return baseFavicoDomain});var baseUrl="/",closeModalCallback={},MODALBOX_SELECTOR="#modalBox";Handlebars.registerHelper("formatUnixTs",function(a){return new Date(a).toLocaleString()}),Handlebars.registerHelper("toLowerCase",function(a){return a.toLowerCase()}),Handlebars.registerHelper("toUpperCase",function(a){return a.toUpperCase()}),Handlebars.registerHelper("cut",function(a,b){return cut(a,b)});var profilesTmpl,apiUrlProfileList="/api/v1/user/profiles/list",selectedProfile={
l_profile_id:0,s_profile_name:"",s_color:""},profiles=[selectedProfile],onProfileSelectedListeners=[],onProfilesAvailableListeners=[],onProfileDataChangedListeners=[],apiShareCollection="api/v1/collections/share";Handlebars.registerHelper("favico",function(a){return baseFavicoDomain+a}),Handlebars.registerHelper("log",function(a,b,c){}),Handlebars.registerHelper("timediff",function(a){var b=(renderTime-a)/1e3,c=Math.round(b/60);if(c<60)return c+"m";var d=Math.round(c/60);if(d<24)return d+"h";var e=Math.round(d/24);return e+"d"}),Handlebars.registerHelper("tools",function(a,b,c){return a==TEMPLATE_ID_SAVED?'<a href="" onclick="removeEntry('+b+');return false;">R</a>':'<a href="" onclick="saveEntry('+b+');return false;"><span class="glyphicon glyphicon-floppy-disk"></span></a>'}),Handlebars.registerHelper("position",function a(){return++a}),Handlebars.registerHelper("showGroupCount",function(a,b){return queryGroups.showUnreadOnly||b?a.l_gr_unread:""}),Handlebars.registerHelper("showNextOptions",function(a){for(var b=!1,c=!1,d=void 0,e=void 0,f=void 0,g=0;g<filteredStreamGroups.length;g++)sg=filteredStreamGroups[g],sg.l_stream_id!=selectedStream.l_stream_id?0!=sg.l_gr_unread&&(b=!0,c?c&&void 0==f&&(f=sg):d=sg):(e=sg,e.x=g,c=!0);var h="";return b?(void 0!=d&&(h+=" Move up to <a href='#/f/"+d.l_stream_id+"'>"+d.s_stream_name+"</a>"),void 0!=f&&(void 0!=d&&(h+=" <br>or<br> "),h+=" Move down to <a href='#/f/"+f.l_stream_id+"'>"+f.s_stream_name+"</a>"),h):"... and there are no more streams with unread stories."}),Handlebars.registerHelper("sourceName",function(a){return idx=subscriptionsIdx.indexOf(a),idx!=-1?subscriptions[idx].s_subs_name:"n.a."}),Handlebars.registerHelper("showSourceData",function(a,b,c,d){if(b.showIco||b.showSource){var e="";return c&&(e+='<div class="col-xs-'+b.leftSize+' text-left">'),b.showIco&&(e+='<img name="favico_'+a+'" class="favico" src="'+baseUrl+'/img/16x16t.png">'),b.showSource&&(idx=subscriptionsIdx.indexOf(a),e+=idx!=-1?'&nbsp;<a name="source_'+a+'" href="#/s/'+a+'">'+cut(subscriptions[idx].s_subs_name,b.sourceLen)+"</a>":'&nbsp;<a name="source_'+a+'" href="#/s/'+a+'">source</a>'),c&&(e+="</div>"),e}return""});var MAX_INPUT_SIZE=50,CONTENT_MAX_LEN=500,NOCACHE=0,VIEW_LIST=1,VIEW_MAGAZINE=2,VIEW_STREAM=3,TEMPLATE_ID_STREAM="stream",TEMPLATE_ID_ALL="all",TEMPLATE_ID_RECENTLY_READ="rr",TEMPLATE_ID_SAVED="saved",TEMPLATE_ID_SOURCE="source",FILTER_SHOW_ALL=0,FILTER_BY_UNREAD=1,SORT_NEW_FIRST=0,SORT_OLD_FIRST=1,ROUTE_FEED="f",ROUTE_FEED_SOURCE="s",ROUTE_VIEW="v",ROUTE_ALL="a",ROUTE_SAVED="s",ROUTE_RECENTLY_READ="r",apiCurrentStreamsFeed=";",apiUrlStreamsFeedAll="/api/v1/user/feeds/all",apiUrlStreamsFeedRecent="/api/v1/entries/recently_read",apiUrlStreamsFeedSaved="/api/v1/entries/saved",apiUrlStreamsFeed="/api/v1/user/streams/feed",apiUrlMarkRead="/api/v1/entries/read",apiUrlStreamUpdate="/api/v1/user/streams/update",apiUrlStreamDelete="/api/v1/user/streams/delete",apiUrlStreamsList="/api/v1/user/streams/list",apiUrlStreamsMarkAllRead="/api/v1/user/streams/allread",apuUrlStreamsUnreadCount="/api/v1/user/streams/unreadcount",apiUrlSaveReaderSettings="/api/v1/user/settings/reader",apiUrlSaveModulesSettings="/api/v1/user/settings/modules",apiUrlEntriesData="/api/v1/user/feeds/data",apiUrlSourcesGet="/api/v1/sources/get",apiUrlSubscriptionsAdd="/api/v1/user/subscriptions/add",apiUrlRecentlyReadClear="/api/v1/entries/clear_recently_read",apiUrlEntriesEntry="/api/v1/entries/entry",apiUrlStreamsRename="/api/v1/user/streams/rename",apiUrlEntriesUpdate="/api/v1/entries/update",apiUrlSubscriptionsGet="/api/v1/user/subscriptions/get",apiUrlSourceId="/api/v1/user/feeds/sourceid",apiUrlStreamsAdd="/api/v1/user/streams/add",baseFavicoDomain="https://www.google.com/s2/favicons?domain=",streamId=0,streamDir=0,entriesApi="",readerHome="",profileId=0,tmplOptions={id:"",showIco:!0,showSource:!0,sourceLen:12},streamGroups={},filteredStreamGroups=streamGroups,selectedStream={},streamEntries={},moreAvailable=!0,currentView=1,streamGroupsTmpl,streamGroupHeaderTmpl,sourceHeaderTmpl,recentlyReadHeaderTmpl,simpleViewHeaderTmpl,contentAllRead={},entriesTmpl,viewLineTmpl,viewMagTmpl,viewNewsTmpl,pageUnknownTmpl,streamPage=0,entriesPerPage=0,pendingRequest=!1,topUnread=void 0,lastRead=void 0,queryGroups={showUnreadOnly:!1,sortByAlphabet:0,sortByUnread:0},renderTime=(new Date).getTime(),onEntriesLoadedListeners=[],onViewChangedListeners=[],router={},streamSubscriptions=[],namedStreamSubscriptions={},apiSubscriptionAddToStream="/api/v1/user/subscriptions/addtostream",apiSubscriptionRemoveFromStream="/api/v1/user/subscriptions/removefromstream",queryAll={sortBy:"s_subs_name",keyword:""},querySubs={sortBy:"s_subs_name",keyword:""},idSearchAll="searchQueryAll",idSearchSubs="searchQuerySubs",allSubsTmpl,subsTmpl,r={},profilesSettingsTmpl={},subscriptionsHome="",subscriptions=[],subscriptionsIdx=[],filteredSubscriptions=[{l_subs_id:0,s_subs_name:0}],selectedSubscriptionId=0,allSubscriptionsTmpl={},profileStreamGrpTmpl={},jlinqQuery={},query={sortBy:"s_subs_name",showOnlyInactive:!1,showZeroSources:!1,keyword:""},onAllSubscriptionsAvailableListeners=[],sr={};
//# sourceMappingURL=app.legacy.min.js.map