var streamSubscriptions=[];var namedStreamSubscriptions={};var apiSubscriptionAddToStream="/api/v1/user/subscriptions/addtostream";var apiSubscriptionRemoveFromStream="/api/v1/user/subscriptions/removefromstream";var queryAll={sortBy:"s_subs_name",keyword:""};var querySubs={sortBy:"s_subs_name",keyword:""};var idSearchAll="searchQueryAll";var idSearchSubs="searchQuerySubs";var allSubsTmpl;var subsTmpl;function initReaderSubscriptions(){allSubsTmpl=Handlebars.compile($("#all_subscriptions_tmpl").html());subsTmpl=Handlebars.compile($("#subscribed_tmpl").html());$("#"+idSearchAll).on("keyup",function(a){if((a.keyCode||a.which)==27){}filterByKeywordAll(a.target.value);runQuery()});$("#"+idSearchSubs).on("keyup",function(a){if((a.keyCode||a.which)==27){}filterByKeywordSubs(a.target.value);runQuery()});fetchAllSubscriptions()}function renderAllReaderSubscriptions(a){$("#all_count").text(a.length);$("#all_subscriptions").html(allSubsTmpl({subscriptions:a}))}function clearStreamSubscriptions(){while(streamSubscriptions.length>0){streamSubscriptions.pop()}while(namedStreamSubscriptions.length>0){namedStreamSubscriptions.pop()}}function fetchAllStreamSubscriptions(a,b){getAllStreamSubscriptions(a,function(c){clearStreamSubscriptions();$("#stream_count").text(c.entries.length);if(c&&c.entries){streamSubscriptions=c.entries;c.entries.forEach(function(g,f,d){namedStreamSubscriptions["s"+g.l_subs_id]={};namedStreamSubscriptions["s"+g.l_subs_id].name=g.s_subs_name;namedStreamSubscriptions["s"+g.l_subs_id].xml_id=g.l_xml_id})}if(b){b(c)}})}function renderReaderSubscriptions(a){$("#stream_count").text(a.length);$("#subscribed").html("");$("#subscribed").html(subsTmpl({subscriptions:a}))}function fetchAllSubscriptions(a){apiGetAllSubscriptions(function(c){$("#all_count").text(subscriptions.length);for(var b=subscriptions.length-1;b>=0;b--){if(namedStreamSubscriptions["s"+subscriptions[b].l_subs_id]){subscriptions.splice(b,1)}}if(a){a(c)}})}function renderSubscriptions(){filterByKeywordAll();filterByKeywordSubs()}function removeSubscription(b){var a={};a.sid=selectedStream.l_stream_id;a.sui=b;$.getJSON(baseUrl+apiSubscriptionRemoveFromStream,a,function(c){if(c.count>0){$("#subscription_r_"+b).remove();$("#subscription_r_"+b).empty();$("#reload").show()}else{console.error(c)}})}function addSubscription(b){var a={};a.sid=selectedStream.l_stream_id;a.sui=b;$.getJSON(baseUrl+apiSubscriptionAddToStream,a,function(c){if(c.count>0){$("#subscription_l_"+b).remove();$("#subscription_l_"+b).empty();$("#reload").show()}else{console.error(c)}})}function filterByKeywordAll(a){queryAll.keyword=(a)?a:$("#"+idSearchAll).val();runReaderQuery(subscriptions,queryAll,true)}function filterByKeywordSubs(a){querySubs.keyword=(a)?a:$("#"+idSearchSubs).val();runReaderQuery(streamSubscriptions,querySubs,false)}function runReaderQuery(c,b,a){var d=jlinq.from(c).sort(b.sortBy);if(b.keyword&&b.keyword.length>0){d.contains("s_subs_name",b.keyword)}if(a){renderAllReaderSubscriptions(d.select())}else{renderReaderSubscriptions(d.select())}};