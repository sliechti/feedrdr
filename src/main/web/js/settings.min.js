var r={};var profilesSettingsTmpl={};function initSettings(){profilesSettingsTmpl=Handlebars.compile($("#all_profiles_settings_tmpl").html());var a=new Router().init();a.on("/v/:panel",loadSettingsView);a.on("/v/:panel/:val",loadSettingsView);r=a.getRoute()}function setupProfileView(a){$("#profile_settings_list").html(profilesSettingsTmpl({profiles:a}));loadColorPickers()}function loadSettingsView(b,a){console.log("show panel "+b+", val "+a);$("#content_panel").children().each(function(c,d){if(d.id=="error"||d.id=="info"){return}$(d).hide()});$("#"+b).show()}function showMessage(a,b){if(!b||b==""){$("#"+a).hide();return}$("#"+a+"_text").text(b);$("#"+a).show()}function showError(a){showMessage("error",a)}function showInfo(a){showMessage("info",a)}function loadColorPickers(){$("#profile_settings_list").children("div").each(function(b,d){var c=$("#picker_"+d.id);c.change(changeProfileColor);var a=new jscolor.color(c.get(0),{slider:true,pickerFaceColor:"transparent",pickerMode:"HSV",pickerFace:1,pickerBorder:0,pickerInsetColor:"black"});a.fromString(c.attr("data-color"))})}function saveProfile(d){var c=$("#name_profile_"+d).val();var b=$("#picker_profile_"+d).val();var a={};a.pid=d;a.n=c;a.c=b;$.getJSON(baseUrl+"/api/v1/user/profiles/save",a,function(e){if(e.count>0){$("#profile_"+d).addClass("saved");setTimeout(function(){$("#profile_"+d).removeClass("saved")},1500);renameProfile(d,c,b)}else{console.error("error saving profile");console.error(e)}})}function deleteProfile(b){if(confirm("Are you sure? Deleting a profile means:\n* All recently read and saved information for this profile is deleted. \n* Any stream groups not used by other profiles are deleted.")){showError("");var a={};a.pid=b;console.log("deleting profile  "+b);$.getJSON(baseUrl+"/api/v1/user/profiles/delete",a,function(c){if(c.count>0){location.reload()}else{if(c.error){console.log(c.error);showError(c.error)}else{console.log(c)}}})}};