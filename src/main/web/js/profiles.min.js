var profilesTmpl;var apiUrlProfileList="/api/v1/user/profiles/list";var selectedProfile={l_profile_id:0,s_profile_name:"",s_color:""};var profiles=[selectedProfile];var onProfileSelectedListeners=[];var onProfilesAvailableListeners=[];var onProfileDataChangedListeners=[];function initProfiles(){registerOnProfileSelected(function(){renderProfiles()});registerOnProfileDataChange(function(){renderProfiles()});$.getJSON(baseUrl+apiUrlProfileList,"",function(a){profiles={};if(a.entries){profiles=a.entries;triggerOnProfilesAvailable()}else{console.error("error fetching profiles ");console.error(a)}})}function renderProfiles(){if(!profilesTmpl){profilesTmpl=Handlebars.compile($("#nav_profiles_tmpl").html())}$("#profiles").html(profilesTmpl({profiles:profiles}))}function registerOnProfileSelected(a){onProfileSelectedListeners.push(a)}function registerOnProfilesAvailable(a){onProfilesAvailableListeners.push(a)}function registerOnProfileDataChange(a){onProfileDataChangedListeners.push(a)}function triggerOnProfilesAvailable(){for(var a=0;a<onProfilesAvailableListeners.length;a++){onProfilesAvailableListeners[a](profiles)}}function triggerOnProfileSelected(b){for(var a=0;a<onProfileSelectedListeners.length;a++){onProfileSelectedListeners[a](b)}}function triggerOnProfileDataChanged(){for(var a=0;a<onProfileDataChangedListeners.length;a++){onProfileDataChangedListeners[a](profiles)}}function setSessionProfile(a,b){$.get(baseUrl+"/pages/set_profile.jsp?id="+a,function(c){if(b){b(c)}})}function selectProfile(c,b){if(b){window.location.hash=""}if(c==0){return}for(var a=0;a<profiles.length;a++){if(profiles[a].l_profile_id==c){selectedProfile=profiles[a]}}if(selectedProfile.l_profile_id==0){console.error("unknown profile id "+c)}$(".profileColor").css("background-color","#"+selectedProfile.s_color);$("#profile").text(selectedProfile.s_profile_name);setSessionProfile(c,function(){triggerOnProfileSelected(selectedProfile)})}function renameProfile(d,b,a){if(d==$("#profile").attr("data-id")){$("#profile").attr("data-id",d);$("#profile").text(b)}for(var c=0;c<profiles.length;c++){if(profiles[c].l_profile_id==d){profiles[c].s_profile_name=b;if(a){profiles[c].s_color=a}triggerOnProfileDataChanged();return}}}function showCreateNewProfile(){showModal("Create new Profile","#div_new_profile",function(){$("#loader").css("background-color","#"+selectedProfile.s_color)});$("input[name=profile_name]").focus();var b=$("input[name=picker]");b.change(changeProfileColor);var a=new jscolor.color(b.get(0),{slider:false,pickerFaceColor:"transparent",pickerFace:3,pickerBorder:0,pickerInsetColor:"black"});a.fromString("99FF33")}function changeProfileColor(a){$("#loader").css("background-color","#"+a.target.value)}function closeNewProfile(){hideModal()}function createNewProfile(d,e){var c=$("input[name="+d+"]");var b=$("input[name="+e+"]");var a={};a.n=c.val();a.c=b.val();$.getJSON(baseUrl+"/api/v1/user/profiles/new",a,function(f){if(f.success){setSessionProfile(f.profileid,function(){location.reload()});hideModal()}else{$("#modal_error_text").text("Couldn't add profile. "+f.error);$("#modal_error").show();return}})};